# 事業継続計画 (BCP) - PC故障時の対応策

社内PC（サーバー機）が故障した場合でも、業務を最小限のダウンタイムで復旧させるための「保険」となる計画書です。

---

## 🛡️ 基本戦略：3つのレベル

リスク許容度とコストに応じて、以下の対策を組み合わせます。推奨は **【レベル1 + レベル2】** です。

| レベル | 対策 | 復旧目標時間 | コスト | 概要 |
| :--- | :--- | :--- | :--- | :--- |
| **Lv.1** | **クラウド自動バックアップ** | 数時間 | 無料 | データをGoogle Drive/OneDriveに自動保存。PC交換時にデータを戻す。 |
| **Lv.2** | **予備機（コールドスタンバイ）** | 10分 | ハード代のみ | 別のPC（ノートPC等）に環境を作っておき、故障時は差し替えるだけにする。 |
| **Lv.3** | **クラウドサーバー（Azure VM）** | 0分 | 月額数千円〜 | 常にクラウド上で動かす。ただしAccess DBとの連携が課題。 |

---

## 📦 Lv.1 データ自動バックアップの手順

**目的**: PCが全損・紛失しても、データ（商品・取引履歴）だけは絶対に守る。

1.  **クラウドストレージの導入**
    - Google Drive（パソコン版）または OneDrive をインストールし、PC内の特定フォルダをクラウドと同期させます。
    - 例: `C:\Users\Kojima\OneDrive\Backup_StockPWA`

2.  **バックアップスクリプトの設定**
    - 現在の `scripts/backup_db.ps1` をタスクスケジューラで毎日実行します。
    - 保存先を上記のクラウド同期フォルダに指定します。

    ```powershell
    # タスクスケジューラの設定例
    プログラム: pwsh.exe
    引数: -File F:\Antigravity\stock-pwa\scripts\backup_db.ps1 -BackupFolder "C:\Users\Kojima\OneDrive\Backup_StockPWA"
    ```

---

## 💻 Lv.2 予備機（スタンバイ機）の準備

**目的**: PC故障時、新しいPCのセットアップを待たずに業務を再開する。

### 1. 予備機の選定
- 社内にある別のWindows PC（ノートPCでも可）。
- 普段は別の用途に使っていてもOK。

### 2. 事前セットアップ（平時にやっておく）
- `Node.js` と `Git` をインストール。
- ソースコードをコピー（`git clone`）。
- `npm install` を実行し、`npm run build` まで通ることを確認。
- `.env` ファイルをコピーして配置。

### 3. いざという時の切り替え手順
メイン機が壊れたら...

1.  予備機を起動。
2.  クラウド（Lv.1）から最新のバックアップデータ（`dev_yyyymmdd.db`）をダウンロード。
3.  予備機の `stock-pwa` フォルダに `dev.db` として上書き配置。
4.  `npm run start` でサーバー起動。
5.  タブレットのブラウザで、予備機のIPアドレス（`http://[予備機IP]:3000`）にアクセス先を変更。

---

## 🚨 緊急復旧フロー

もし今日メインサーバーが動かなくなった場合：

1.  **現状確認**
    - 電源が入らないのか？ ネットが繋がらないだけか？
    - ネットの問題なら、再起動やルーター確認。

2.  **予備機への切り替え（Lv.2実施済みの場合）**
    - 予備機でサーバー起動。
    - タブレットのブックマークを変更。

3.  **完全再セットアップ（予備機がない場合）**
    - 新しいPCを用意。
    - `docs/migration_guide.md` の手順に従い環境構築。
    - クラウドバックアップから `dev.db` を復元。

---

## ✅ 定期チェックリスト

- [ ] クラウドストレージにバックアップファイルが毎日作成されているか？（週1回確認）
- [ ] 予備機のWindows Updateやアプリ更新（月1回推奨）
- [ ] 予備機でサーバーが起動するかテスト（半年に1回推奨）
