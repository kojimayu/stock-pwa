# クラウドデプロイ計画書（コスト比較版）

## 概要

現在ローカルPC上で稼働している STOCK-PWA をクラウドへ移行するための計画。
Azure以外の選択肢も含め、**コスト最小化**と**データ損失防止**を両立する方式を比較検討する。

---

## 方式の比較（5パターン）

| # | 方式 | 月額コスト | データ安全性 | 外出先アクセス | 工数 |
|---|------|-----------|------------|--------------|------|
| **A** | **現状維持 + 自動バックアップ強化** | **¥0** | ⭐⭐⭐⭐ | ❌ 不可 | 半日 |
| **B** | **Railway (Next.js + PostgreSQL)** | **¥1,500〜2,500** | ⭐⭐⭐⭐⭐ | ✅ 可能 | 1週間 |
| **C** | **Vercel + Supabase** | **¥3,000〜4,000** | ⭐⭐⭐⭐⭐ | ✅ 可能 | 1週間 |
| **D** | **Azure (App Service + PostgreSQL)** | **¥10,000** | ⭐⭐⭐⭐⭐ | ✅ 可能 | 1〜2週間 |
| **E** | **VPS (ConoHa/さくら)** | **¥1,000〜2,000** | ⭐⭐⭐ | ✅ 可能 | 2週間 |

---

## A. 現状維持 + 自動バックアップ強化（¥0/月）

### 内容
ローカルPC運用のまま、**データ損失だけを防ぐ**ことに集中する。

### やること
1. **OneDriveへの自動バックアップ**（タスクスケジューラで毎時実行）
2. **GitHubへのDB暗号化バックアップ**（日次）
3. **SQLiteのWALモード有効化**（書き込み中の破損防止）

### コスト内訳

| 項目 | 月額 |
|------|------|
| OneDrive | ¥0（Microsoft 365に含まれている場合） |
| GitHub | ¥0 |
| **合計** | **¥0** |

### メリット・デメリット

| メリット | デメリット |
|----------|------------|
| コストゼロ | 外出先からアクセス不可 |
| 今すぐ実装可能 | PCの故障・停電リスクは残る |
| Access DBもそのまま使える | 復旧は手動（数十分） |

> [!TIP]
> **「データ損失だけ避けたい」が最優先なら、この方式が最もコスパが良い。**
> クラウド移行は「外出先アクセス」や「PC故障時の即時復旧」が必要になった時に検討すればよい。

---

## B. Railway（¥1,500〜2,500/月）⭐ 推奨

### 内容
Next.js + PostgreSQL をRailway上にデプロイ。GitHub連携で自動デプロイ。

### コスト内訳

| 項目 | 月額(USD) | 月額(JPY) |
|------|-----------|-----------|
| Hobby Plan基本料 | $5 | ¥750 |
| Next.js コンピュート | $5〜10 | ¥750〜1,500 |
| PostgreSQL | $2〜5 | ¥300〜750 |
| **合計** | **$12〜20** | **¥1,800〜3,000** |

### メリット・デメリット

| メリット | デメリット |
|----------|------------|
| 最安クラスのクラウド | 日本リージョンなし（US） |
| GitHub pushで自動デプロイ | 軽い遅延（体感0.1〜0.3秒） |
| PostgreSQL込み | 障害時のサポートは限定的 |
| 自動バックアップあり | |

---

## C. Vercel + Supabase（¥3,000〜4,000/月）

### 内容
Vercel（Next.js最適化ホスティング）+ Supabase（PostgreSQL + 自動バックアップ）

### コスト内訳

| 項目 | 月額(USD) | 月額(JPY) |
|------|-----------|-----------|
| Vercel Pro | $20 | ¥3,000 |
| Supabase Free | $0 | ¥0 |
| **合計** | **$20** | **¥3,000** |

> [!WARNING]
> **Supabase無料プランは7日間無活動でプロジェクトが一時停止される。**
> 毎日使うシステムなら問題ないが、長期休暇時に注意。
> 安全を期すなら Supabase Pro ($25/月) にすると合計 ¥6,750/月。

### メリット・デメリット

| メリット | デメリット |
|----------|------------|
| Next.jsに最適化（最速） | Vercel Proが$20/月 |
| 東京エッジ配信で高速 | Supabase無料は制限あり |
| Server Actionsと相性◎ | DB容量500MBまで（無料） |

---

## D. Azure（¥10,000/月）

[別途 azure_deployment_plan.md 参照](file:///f:/Antigravity/stock-pwa/docs/stock-pwa/azure_deployment_plan.md)

### メリット・デメリット

| メリット | デメリット |
|----------|------------|
| 企業向けSLA保証 | 月額が最も高い |
| Azure AD連携が容易 | 設定が複雑 |
| 日本リージョン | |

---

## E. VPS（¥1,000〜2,000/月）

### 内容
ConoHa VPSやさくらVPS等の国内VPSにNext.js + SQLiteをそのまま載せる。

### コスト内訳

| 項目 | 月額(JPY) |
|------|-----------|
| ConoHa VPS 1GB | ¥880 |
| ドメイン（任意） | ¥100 |
| **合計** | **¥980** |

### メリット・デメリット

| メリット | デメリット |
|----------|------------|
| 最安（¥1,000以下） | サーバー管理が自力 |
| 日本のデータセンター | セキュリティ更新も自力 |
| SQLiteのまま使える | OS/Nginx設定が必要 |

> [!CAUTION]
> VPSはサーバー管理の知識が必要。セキュリティパッチの適用やSSL証明書の更新を自分で行う必要がある。

---

## Access DB 同期（全方式共通）

クラウド移行する場合、Access DBとの連携方法は以下いずれか：

| 方式 | 内容 | 推奨度 |
|------|------|--------|
| **定期バッチ同期** | 社内PCでタスクスケジューラ実行、APIでクラウドに送信 | ⭐⭐⭐ |
| **物件マスタをアプリ内で管理** | Excelインポートで物件データを登録。Access参照を廃止 | ⭐⭐⭐⭐ |
| **Access廃止→クラウドDB統合** | Access自体を移行（大規模作業） | ⭐ |

> [!IMPORTANT]
> **Access DBは「管理Noから物件情報を検索する」用途のみ。**
> 頻度も低いため、**物件マスタをExcelで取り込む方式**にすれば同期自体が不要になる。

---

## 推奨アクション

### 今すぐやるべきこと（方式A: ¥0）
- [ ] OneDriveへの自動バックアップ設定
- [ ] SQLite WALモード有効化
- [ ] バックアップ復旧テストの実施

### 将来の検討（方式B/C: ¥1,500〜3,000）
- 外出先アクセスが必要になったタイミングで移行
- まずはRailway（方式B）が最もバランスが良い

---

## まとめ

| 判断基準 | 推奨方式 |
|----------|----------|
| データ損失だけ防ぎたい（最安） | **A. 現状維持 + バックアップ強化（¥0）** |
| 外出先アクセスも欲しい（コスパ重視） | **B. Railway（¥1,500〜2,500）** |
| Next.js最適環境で高速化したい | **C. Vercel + Supabase（¥3,000〜）** |
| 企業グレードのSLAが必要 | **D. Azure（¥10,000）** |
