# 倉庫設置型 Kiosk 運用計画

## システム構成

```
┌─────────────────────────────────────────────────────────────┐
│                        倉庫内ネットワーク                      │
│                                                             │
│   ┌──────────────┐         Wi-Fi         ┌──────────────┐   │
│   │   Windows PC │◄─────────────────────►│ Android      │   │
│   │  (サーバー)   │      192.168.x.x      │ タブレット    │   │
│   │              │                       │ (Kiosk)      │   │
│   └──────┬───────┘                       └──────────────┘   │
│          │                                                  │
│          │ ローカル接続                                       │
│          ▼                                                  │
│   ┌──────────────┐                                          │
│   │  Access DB   │                                          │
│   │  (物件情報)   │                                          │
│   └──────────────┘                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 注意事項・リスク

### ⚠️ PC 常時稼働のリスク

| リスク | 影響 | 対策 |
|--------|------|------|
| PCがスリープ/シャットダウン | タブレットから接続不可 | スリープ無効化、UPS導入 |
| Windows Update による再起動 | 業務中にサービス停止 | アクティブ時間の設定 |
| IPアドレスの変更 | タブレットのURL無効化 | 固定IP設定 |
| 停電 | データ損失・サービス停止 | UPS、自動起動設定 |
| PCの故障 | 完全停止 | バックアップ体制 |

### ⚠️ ネットワークのリスク

| リスク | 影響 | 対策 |
|--------|------|------|
| Wi-Fi切断 | タブレット接続不可 | 有線LANの検討、ルーター確認 |
| DHCPリース切れ | IPアドレス変更 | PC側を固定IP化 |

---

## やるべきこと（チェックリスト）

### 1. PC側の設定

- [ ] **固定IPアドレスの設定**
  - 現在: `192.168.11.172` (DHCP割当の可能性)
  - 推奨: ルーターでDHCP予約、またはPC側で静的IP設定

- [ ] **スリープ・休止を無効化**
  - 設定 → システム → 電源とスリープ → 「なし」に設定
  - ディスプレイは切れてもOK

- [ ] **自動ログオン設定**
  - 停電後の再起動時に自動でログイン

- [ ] **スタートアップにサーバー起動を追加**
  - `npm run start` (本番) または `npm run dev` (開発) を自動実行

- [ ] **Windows Update の制御**
  - アクティブ時間を業務時間外に設定
  - 自動再起動を無効化（可能なら）

- [ ] **ファイアウォール許可**
  - ポート3000を許可（Node.jsアクセス用）

### 2. タブレット側の設定

- [ ] **Fully Kiosk Browser のインストール**
- [ ] **起動URLの設定**: `http://192.168.11.172:3000`
- [ ] **Kioskモード有効化**
- [ ] **管理者パスワード設定**（終了防止）
- [ ] **自動起動設定**（電源ON時）
- [ ] **スクリーンセーバー無効化**
- [ ] **画面の自動回転ロック**

### 3. バックアップ戦略（重要）

ローカル運用の最大のリスクはデータ損失です。以下の多層バックアップを推奨します。

#### レベル1: 自動ローカルバックアップ（毎日）
- `prisma/dev.db` を別フォルダに自動コピー
- Windowsタスクスケジューラで毎晩実行
- 過去7日分を保持

```powershell
# 実際のスクリプト: scripts/backup_db.ps1
# OneDrive組織用フォルダに2ヶ月分(60日)保持
# 詳細な設定手順: docs/backup_setup_guide.md を参照
```

#### レベル2: クラウド同期（OneDrive/Google Drive）
- バックアップフォルダをクラウドストレージに同期
- PCが壊れても別PCから復元可能
- **無料枠で十分対応可能**

#### レベル3: 週次手動バックアップ（推奨）
- USBメモリや外付けHDDに週1回コピー
- 物理的な災害対策

---

## 確定した運用構成

```
┌─────────────────────────────────────────────────────────────┐
│                        社内ネットワーク                       │
│                                                             │
│   ┌──────────────┐         Wi-Fi         ┌──────────────┐   │
│   │ サーバーPC    │◄─────────────────────►│ タブレット    │   │
│   │ (Node.js)    │      固定IP予定        │ Fully Kiosk  │   │
│   │ + SQLite DB  │                       │              │   │
│   └──────┬───────┘                       └──────────────┘   │
│          │                                                  │
│          │ ネットワーク共有 (\\AccessPC\...)                  │
│          ▼                                                  │
│   ┌──────────────┐        ┌──────────────┐                  │
│   │  Access DB   │        │ OneDrive等   │                  │
│   │  (別PC)      │        │ (バックアップ) │                  │
│   └──────────────┘        └──────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 実施手順（優先順）

### Phase 1: 動作確認（今週）
- [ ] Access DB のネットワークパスを確認
- [ ] APIがネットワーク経由でAccess DBに接続できるかテスト
- [ ] 本番ビルドで動作確認 (`npm run build && npm run start`)

### Phase 2: タブレット設定
- [ ] Fully Kiosk Browser インストール・設定
- [ ] 動作テスト

### Phase 3: バックアップ構築
- [ ] バックアップ用PowerShellスクリプト作成
- [ ] タスクスケジューラで自動化
- [ ] クラウド同期設定（OneDrive推奨）

### Phase 4: 本番移行
- [ ] サーバーPCを決定
- [ ] 固定IP設定
- [ ] サービス自動起動設定
- [ ] 1週間の試験運用

---

## 将来のクラウド移行について

ローカル運用が安定したら、以下のタイミングでクラウド移行を検討:

- PCの老朽化・故障時
- 外出先からのアクセスが必要になった時
- 複数拠点での運用が必要になった時

**移行時のコスト目安**: 月額2,000〜5,000円（Azure App Service + DB）

---

## 次のアクション

1. **Access DBのネットワークパスを教えてください**
   - 例: `\\192.168.11.xxx\共有フォルダ\database.mdb`
   - または `\\PC名\共有フォルダ\database.mdb`

2. **バックアップ先の希望**
   - OneDrive / Google Drive / 外付けHDD など

