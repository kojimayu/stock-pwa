# 箱単位販売ロジックの実装

## 概要
商品に対して「箱（ケース）」単位での販売を可能にするため、以下の変更を行いました。
これにより、在庫管理は「個数（Unit）」ベースで維持しつつ、ユーザーは「箱」として購入することが可能になります。
1箱購入時の在庫減算は「箱入数 (quantityPerBox)」に基づいて自動計算されます。

## 変更内容

### 1. データベーススキーマ (`prisma/schema.prisma`)
Productモデルに以下のフィールドを追加しました。
- `manufacturer`: メーカー名
- `quantityPerBox`: 1箱あたりの個数 (デフォルト: 1)
- `pricePerBox`: 1箱あたりの価格 (デフォルト: 0)
- `orderUnit`: 発注単位 (デフォルト: 1) ※既存ロジック補完

### 2. 管理画面 (`components/admin/`)
- **商品登録・編集**: メーカー、箱入数、箱単価の入力フィールドを追加しました。
- **インポート/エクスポート**: Excelファイルでの上記フィールドの入出力をサポートしました（日本語ヘッダー「メーカー」「箱入数」「箱単価」対応）。

### 3. Kiosk UI (`components/kiosk/`)
- **商品選択ダイアログ (`QuantitySelectorDialog`)**: 
    - 「バラ」と「箱」の切り替えタブを実装しました。
    - 「箱」選択時は、在庫が箱数ベースで表示され、価格も箱単価が適用されます。
    - 数量選択ボタンもモードに応じて適切な刻みに変更されます。
- **カート (`CartList`)**:
    - 箱単位で購入した商品には「箱 (XX個入)」というバッジを表示し、区別できるようにしました。
    - 同じ商品でも「バラ」と「箱」は別々の明細として扱われます。

### 4. ロジック実装 (`lib/store.ts`, `lib/actions.ts`)
- **カートストア**: `isBox` フラグをカートアイテムに追加し、箱単位での追加・削除・数量変更に対応しました。
- **取引作成 (`createTransaction`)**: 
    - カート内の `isBox` アイテムについて、在庫減算時に `quantity * quantityPerBox` を計算して減算するように変更しました。
    - 操作ログにも `(Box)` の表記を追加しました。
- **返品処理 (`returnTransaction`)**:
    - 箱単位で購入された取引の返品時も、正しい個数が在庫に戻されるようにロジックを修正しました。

## 検証項目
- [x] 管理画面で「箱入数: 10」「箱単価: 1000円」の商品を登録できること
- [x] Kioskでその商品をタップした際、「バラ」と「箱」が選択できること
- [x] 「箱」を選択してカートに入れると、カート内で「箱」バッジが表示され、価格が1000円になること
- [x] 決済を行うと、在庫が「10個」減算されること
- [x] 取引履歴から返品を行った際、在庫が「10個」戻されること

## スクリーンショット
(UI変更部分は実際の画面で確認してください)
