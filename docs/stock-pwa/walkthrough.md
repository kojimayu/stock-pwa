# エアコン管理機能実装とKiosk UI改善 (2026-02-02)

## 概要
エアコンの発注・在庫・持出し管理を行うための包括的な機能を実装しました。また、現場で使用するKioskアプリのエアコン持出し画面をタブレット操作に最適化しました。

## 実装機能

### 1. 管理画面 (Admin)

#### 在庫管理 (`/admin/aircon-inventory`)
- **4品目管理**: RAS-AJ22, RAS-AJ25, RAS-AJ28, RAS-AJ36
- **サフィックス個別設定**: 発注時の年度コード（N, M等）を機種ごとに設定可能。
- **在庫調整**: 手動での在庫数増減に対応。
- **アラート**: 最低在庫数を下回るとアラート表示。

#### 発注管理 (`/admin/aircon-orders`)
- **発注作成**: 機種ごとのサフィックスを付与して発注書（データ）を作成。
- **ステータス遷移**: 下書き → 発注済 → 一部入荷 → 入荷完了。
- **入荷処理**: 入荷数を入力し、自動で在庫に加算。

#### ログ・戻し機能 (`/admin/aircon-logs`)
- **持出し履歴**: 管理No、業者、日付でのフィルタリング。
- **戻し機能**: 間違って持出した履歴を「戻す」ことで、記録を更新し**在庫を自動復元**。

### 2. 現場用アプリ (Kiosk)

#### エアコン持出し画面 (`/aircon`)
- **タブレット最適化レイアウト**:
    - 画面を左右2カラムに分割し、スクロールなしで操作完結。
    - **左側**: 管理No検索入力、物件詳細情報表示。
    - **右側**: 持出しリスト（カート）、ワンプッシュ機種選択ボタン、持出し確定ボタン。
- **視認性向上**:
    - 削除ボタンをゴミ箱アイコンに変更。
    - 確定ボタンを大きく緑色にし、押しやすさを改善。
    - 物件情報がない状態では右側をグレーアウトして誤操作防止。

## 技術的変更点

### データベース (Prisma)
- `AirconProduct`: `suffix` カラムを追加し、機種ごとのデフォルトサフィックスを保持。
- `AirconOrder`, `AirconOrderItem`: 発注管理用のモデルを追加。
- `SystemSetting`: システム全体の設定値（初期サフィックス等）用に追加。
- `AirConditionerLog`: `isReturned`, `returnedAt`, `airconProductId` を追加し、在庫連動を実現。

### API / Server Actions
- `lib/aircon-actions.ts`: 在庫操作、発注処理、サフィックス更新等のロジックを集約。
- 取引API (`/api/aircon/transaction`): トランザクション内でログ作成と在庫減算を原子的に実行。

## 今後の課題
- 材料（部材）についても同様の「戻し機能」の実装（要望済み）。
