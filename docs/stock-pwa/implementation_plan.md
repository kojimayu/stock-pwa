# Phase 2: キオスクUI (タブレットアプリ)

## 目標 (Goal)
職人がAndroidタブレット（キオスクモード）を使って、在庫の持ち出し処理を行えるワークフローを実装します。

## ユーザーレビュー事項 (User Review Required)
- **レイアウトの分割**: Next.js の Route Groups 機能を使用します。
    - `(kiosk)/...` -> ルートURL `/` はタブレット利用者向け。
    - `(admin)/admin/...` -> URL `/admin` は事務所の管理者向け。
- **状態管理**: ショッピングカートの状態（今回の取引セッション）は React Context（またはZustand）で管理します。

## 実装内容 (Proposed Changes)

### 1. アーキテクチャ & グローバルスタイル
- `app/(kiosk)/layout.tsx`: タッチ操作に適した、ナビゲーションバー等のない全画面レイアウトを作成します。文字サイズやコントラストも現場向けに調整します。
- `app/(admin)/layout.tsx`: 管理画面用のダッシュボードレイアウト（サイドバー付き）の枠組みを作成します。

### 2. 業者ログイン (PIN入力)
- **パス**: `/` (ホーム画面)
- **コンポーネント**: `PinPad`（大きな数字ボタンのキーパッド）
- **ロジック**:
    - ユーザーが4桁のPINを入力。
    - POST `/api/verify-pin` -> 有効なら `vendorId` と名前を返却。
    - 業者情報をセッション/コンテキストに保存し、`/shop` へ遷移。

### 3. 商品選択 (持ち出し画面)
- **パス**: `/shop`
- **コンポーネント**:
    - `ProductGrid`: `ProductCard` を並べるグリッド。
    - `ProductCard`: 大きなタッチ領域。名前、価格、在庫を表示。タップでカートに追加。
    - `CategoryFilter`: カテゴリ切り替えタブ。
    - `CartSummary`: 画面下部に固定、またはフローティングボタンで「現在の点数」を表示。
- **ロジック**:
    - Server Action または API Route で商品一覧を取得 (`Vendor` 認証済みであること)。
    - 「カートに追加」でローカルの数量を増加。

### 4. 出庫確定 (チェックアウト)
- **パス**: `/checkout` (またはモーダル画面)
- **コンポーネント**:
    - 選択したアイテムの一覧（＋/− ボタンで数量調整）。
    - 「確定する」ボタン（大きく、緑色など目立つ色で）。
- **ロジック**:
    - POST `/api/transactions` ->
        - 入力: `vendorId`, `items` (配列: {productId, quantity, price})。
        - サーバー側: `Transaction` レコード作成、`Product` の在庫数 (`stock`) を減算。
    - 成功時: 「お疲れ様でした/完了」画面を表示し、5秒後に自動でログイン画面 (`/`) へ戻る。

## 検証計画 (Verification Plan)
- **ブラウザエミュレーション**: Chrome DevTools のデバイスモードでタブレット（iPad等）を選択し、タッチ領域の大きさや見やすさを確認します。
- **フローマニュアルテスト**:
    1. PIN「1111」を入力 -> ログイン成功。
    2. 「商品A」と「商品B」をタップしてカートに入れる。
    3. 確定ボタンを押す。
    4. 完了画面が表示され、トップに戻ることを確認。
    5. `Prisma Studio` で取引履歴が作成され、在庫が減っていることを確認。
