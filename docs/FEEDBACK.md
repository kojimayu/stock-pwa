# フィードバック・改善メモ

使用中に気づいた改善点をここに記録してください。
優先度が高いものには `[!]` を付けてください。

> **AIへの指示**: 新しい会話開始時に、このファイルの「未対応」セクションを確認して
> 作業予定を提案すること。

---

## 未対応（優先度順）

### � 最優先（データ損失リスク・業務停止回避）
- [!] **オフライン対策**: 棚卸中などにWiFiが切断された場合、気づかずに作業を続けてデータを失うリスクがある。オフライン検知と警告表示の実装が急務。
- [!] **ExcelインポートのID対応**: 現状は「品番」で照合しているため、品番変更時に別商品として二重登録されるリスクがある。「ID」による照合に対応し、データ不整合を防ぐ。

### ⚠️ 優先（UX・操作性改善）
- [!] **メニュー名の変更**：「在庫管理」をクリックすると棚卸画面が出るため、「商品管理」と紛らわしい。メニュー名を実態に合わせて**「棚卸」**に変更する。
- [!] **業者のPIN登録/ログインの遅延**: 登録時やログイン時に関数が「もっさり」したり、更新されない場合がある。原因を調査しパフォーマンスを改善する。
- [!] **接続エラーの誤検知**: 画面更新時などに「接続が切れました」等のエラーが出ることがある。判定ロジック（現在は5秒？）を調整して誤検知を減らす。
- [!] **在庫推移の可視化（時系列台帳）**: 今回の調査のように、いつ何個増減したかをグラフと表で追える機能。不整合の早期発見と原因特定のため、「在庫台帳」画面を実装する。
- [!] **カートの常時表示**: 管理画面の「代理入力」と同様に、Kiosk画面でもカートの中身（選択中の商品）が常に見えるようにUIを改善する。現状は見えないため不安がある。
- [!] **大量数量の入力改善**: 80個など多い数を入力する際、現在は「+ボタン」を連打する必要があり大変（Kiosk/代理入力共に）。数値を直接入力できるテンキーや、+10/+50ボタンなどを追加して操作性を改善する。

### 📝 機能追加・改善
- **エアコン持出し履歴の表示**: 差し戻された案件が履歴に残って紛らわしい。「差戻」ステータスを明示するか、履歴から除外する。
- **ログの抑制**: ターミナルの `HEAD /api/health` ログが目障りなため非表示にする。
- **PINリセット機能**: PINを忘れた場合の救済措置（リセット機能の場所や方法）を明確にする。
- **マニュアル閲覧機能**:
  - 管理画面から `MANUAL_ADMIN.md` を閲覧可能にする
  - Kiosk画面から `MANUAL_VENDOR.md` を閲覧可能にする
- **材料在庫連携**: 材料引取で登録した主要4品目を在庫管理と連動させる。
- **Access連携**: 代表メールアドレスを活用する。
- **棚卸中の管理画面**: 業者端末は禁止だが管理画面は使用可能でよいかの検討。
- **エアコン在庫の分離**: 室内機/室外機を別々に持ち出し・返却できる運用への対応。
- [!] **エアコンの棚卸機能**: 現在の「在庫調整」ボタンによる場当たり的な変更ではなく、毎月の棚卸として実在庫を数え、理論在庫との差異（過不足）を理由とともに記録する「棚卸機能」を実装し、厳格な在庫管理ができるようにする。
- **発注管理機能**: 現状は材料・エアコン共に未実装（データベースのみ）。発注書作成→入荷検品→在庫反映の一連のフローを実装する必要がある。

---

## 対応済み

- ✅ 取引履歴に代理入力バッジ表示（紫色「代理入力」）
- ✅ 商品ごとに代理入力バッジ表示（紫色「代」）
- ✅ 業者選択：テスト業者を最後、よく使う業者を上に表示
- ✅ 価格修正機能（履歴から修正、理由記録、全管理者へメール通知）
- ✅ バックアップ/復旧ドキュメント（docs/BACKUP_RECOVERY.md）
- ✅ 業者有効/無効チェックボックス（Kioskには有効業者のみ表示）
- ✅ 担当者（VendorUser）階層化
- ✅ 担当者の自己登録機能
- ✅ 業者管理の検索クリアボタン追加
- ✅ 新規登録の名前フォント拡大
